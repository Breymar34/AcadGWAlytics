<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AcadGWAlytics : Academic Data Mining Analytics for GWA Prediction</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.png') }}">
  <style>
    /* Spinner overlay */
    #loadingOverlay {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255,255,255,0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }
    /* Modal polish */
    .result-header {
      background: linear-gradient(135deg, #0d6efd, #4dabf7);
      color: #fff;
    }
    .metric-box {
      border: 1px solid rgba(0,0,0,.06);
      border-radius: 1rem;
      padding: 1rem;
      background: #f8f9fa;
    }
    .custom-brand {
     font-family: 'Poppins', sans-serif;
     color: #0d6efd;
     font-weight: 700;
      text-shadow:
        1px 1px 0 #ffffff,
        2px 2px 2px rgba(0,0,0,0.3),
        3px 3px 3px rgba(0,0,0,0.3),
        4px 4px 4px rgba(0,0,0,0.3),
        5px 5px 5px rgba(0,0,0,0.2);
      color: inherit !important;
      text-decoration: none !important;
      cursor: default;
    }
  </style>
</head>
<body class="bg-light">
  <!-- Top bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top shadow-sm">
  <div class="container-fluid">
    <!-- Brand with Logo -->
    <a class="navbar-brand d-flex align-items-center" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">
      <img src="{{ url_for('static', filename='images/logo_gwa.png') }}" alt="GWA Predictor" width="90" height="90" class="d-inline-block align-text-top me-2">
      <span class="custom-brand h5 mb-0">Academic Data Mining Analytics for GWA Prediction</span>
    </a>

    <!-- Toggler Button for Mobile -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Navbar Links -->
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item">
          <a class="nav-link text-primary fw-semibold" href="#" data-bs-toggle="modal" data-bs-target="#aboutModal">
            <i class="bi bi-info-circle-fill me-1"></i> About
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<hr>

<!-- About / Credits Modal -->
<div class="modal fade" id="aboutModal" tabindex="-1" aria-labelledby="aboutModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content shadow-lg border-0 rounded-4">
      <div class="modal-header bg-info text-white rounded-top-4">
        <h5 class="modal-title" id="aboutModalLabel">About This App</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body p-4">
        <p><strong>AcadGWAlytics : Academic Data Mining Analytics for GWA Prediction</strong></p>
        <p>AcadGWAlytics utilizes advanced analytics and machine learning to generate personalized success forecasts based on academic variables including subject-specific grades, entrance exam scores, and other pre-admission requirements.</p>
        <hr>
        <p class="mb-1"><strong>Credits:</strong></p>
        <ul class="mb-0">
          <li>Author / Researcher: <em>Ma.Concepcion R. Repalam</em></li>
          <li>Framework: Bootstrap 5</li>
          <li>Backend: Flask (Python)</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
 
  <div class="container py-5 mt-5">
    <div class="row justify-content-center">
      <div class="col-12 col-lg-8">
        <div class="card shadow-sm border-0 rounded-4">
          <div class="card-body p-4">

            {% if error %}
              <div class="alert alert-danger mt-2 mb-0">
                {{ error }}
              </div>
            {% endif %}

            <h2 class="h4 text-primary mb-3">Student Information</h2>

            <form id="gwaForm" method="POST" action="/" class="row g-3 needs-validation" novalidate>
              <!-- Gender -->
              <div class="col-md-6">
                <label for="gender" class="form-label">Gender</label>
                <select class="form-select" name="gender" id="gender" required>
                  <option value="">--Select Gender--</option>
                  <option value="Male" {% if request.form.get('gender') == 'Male' %}selected{% endif %}>Male</option>
                  <option value="Female" {% if request.form.get('gender') == 'Female' %}selected{% endif %}>Female</option>
                </select>
                <div class="invalid-feedback">Please select a gender.</div>
              </div>

              <!-- School Attended -->
              <div class="col-md-6">
                <label for="school_attended" class="form-label">School Attended</label>
                <select class="form-select" name="school_attended" id="school_attended" required>
                  <option value="">--Select School Type--</option>
                  <option value="Private" {% if request.form.get('school_attended') == 'Private' %}selected{% endif %}>Private</option>
                  <option value="Public" {% if request.form.get('school_attended') == 'Public' %}selected{% endif %}>Public</option>
                </select>
                <div class="invalid-feedback">Please select a school type.</div>
              </div>

              <!-- Academic Track -->
              <div class="col-md-6">
                <label for="track" class="form-label">Senior High School – Academic Track</label>
                <select class="form-select" name="track" id="track" required>
                  <option value="" disabled {% if not request.form.get('track') %}selected{% endif %}>--Select Track--</option>
                  <option value="STEM" {% if request.form.get('track') == 'STEM' %}selected{% endif %}>STEM</option>
                  <option value="ABM" {% if request.form.get('track') == 'ABM' %}selected{% endif %}>ABM</option>
                  <option value="HUMSS" {% if request.form.get('track') == 'HUMSS' %}selected{% endif %}>HUMSS</option>
                  <option value="GAS" {% if request.form.get('track') == 'GAS' %}selected{% endif %}>GAS</option>
                  <option value="TVL" {% if request.form.get('track') == 'TVL' %}selected{% endif %}>TVL
                </select>
                <div class="invalid-feedback">Please select a track.</div>
              </div>

              <!-- Course -->
              <div class="col-md-6">
                <label for="course" class="form-label">Preferred Course</label>
                <select class="form-select" name="course" id="course" required>
                  <option value="" disabled {% if not request.form.get('course') %}selected{% endif %}>--Select Course--</option>
                  <option value="BSIT" {% if request.form.get('course') == 'BSIT' %}selected{% endif %}>Bachelor of Science in Information Technology (BSIT)</option>
                  <option value="BSCS" {% if request.form.get('course') == 'BSCS' %}selected{% endif %}>Bachelor of Science in Computer Science (BSCS)</option>
                  <option value="BSIS" {% if request.form.get('course') == 'BSIS' %}selected{% endif %}>Bachelor of Science in Information Systems (BSIS)</option>
                  <option value="BSECE" {% if request.form.get('course') == 'BSECE' %}selected{% endif %}>Bachelor of Science in Electronics and Communications Engineering (BSECE)</option>
                  <option value="BSEE" {% if request.form.get('course') == 'BSEE' %}selected{% endif %}>Bachelor of Science in Electrical Engineering (BSEE)</option>
                  <option value="BSME" {% if request.form.get('course') == 'BSME' %}selected{% endif %}>Bachelor of Science in Mechanical Engineering (BSME)</option>
                  <option value="BSBA" {% if request.form.get('course') == 'BSBA' %}selected{% endif %}>Bachelor of Science in Business Administration (BSBA)</option>
                  <option value="BSA" {% if request.form.get('course') == 'BSA' %}selected{% endif %}>Bachelor of Science in Accountancy (BSA)</option>
                  <option value="BSED" {% if request.form.get('course') == 'BSED' %}selected{% endif %}>Bachelor of Secondary Education (BSED)</option>
                  <option value="BEED" {% if request.form.get('course') == 'BEED' %}selected{% endif %}>Bachelor of Elementary Education (BEED)</option>
                </select>

                <div class="invalid-feedback">Please select a course.</div>
              </div>

              <hr class="mt-4">
              <h2 class="h4 text-primary mt-2">Academic Records</h2>

              <!-- Grades -->
              <div class="col-md-6">
                <label for="SHS_ENGLISH" class="form-label">Senior High School – English Grade</label>
                <input type="number" class="form-control" name="SHS_ENGLISH" id="SHS_ENGLISH"
                       step="0.01" min="50" max="100" placeholder="e.g., 88.50"
                       value="{{ form_data.get('SHS_ENGLISH','') }}" required>
                <div class="invalid-feedback">Please enter a valid grade between 50–100.</div>
              </div>

              <div class="col-md-6">
                <label for="SHS_MATH" class="form-label">Senior High School – Mathematics Grade</label>
                <input type="number" class="form-control" name="SHS_MATH" id="SHS_MATH"
                       step="0.01" min="50" max="100" placeholder="e.g., 90.00"
                       value="{{ form_data.get('SHS_MATH','') }}" required>
                <div class="invalid-feedback">Please enter a valid grade between 50–100.</div>
              </div>

              <div class="col-md-6">
                <label for="SHS_SCIENCE" class="form-label">Senior High School – Science Grade</label>
                <input type="number" class="form-control" name="SHS_SCIENCE" id="SHS_SCIENCE"
                       step="0.01" min="50" max="100" placeholder="e.g., 91.25"
                       value="{{ form_data.get('SHS_SCIENCE','') }}" required>
                <div class="invalid-feedback">Please enter a valid grade between 50–100.</div>
              </div>

              <div class="col-md-6">
                <label for="SHS_GRADE" class="form-label">Senior High School – General Average</label>
                <input type="number" class="form-control" name="SHS_GRADE" id="SHS_GRADE"
                       step="0.01" min="50" max="100" placeholder="e.g., 89.30"
                       value="{{ form_data.get('SHS_GRADE','') }}" required>
                <div class="invalid-feedback">Please enter a valid grade between 50–100.</div>
              </div>

              <div class="col-md-6">
                <label for="EXAM" class="form-label">Entrance Exam Score</label>
                <input type="number" class="form-control" name="EXAM" id="EXAM"
                       step="0.01" min="0" max="100" placeholder="e.g., 75.00"
                       value="{{ form_data.get('EXAM','') }}" required>
                <div class="invalid-feedback">Please enter a valid score between 0–100.</div>
              </div>

              <!-- Submit & Clear Buttons -->
              <div class="col-12 d-flex gap-2 mt-3">
                <button type="submit" class="btn btn-primary btn-lg">
                  <i class="bi bi-calculator"></i> Predict General Weighted Average (GWA)
                </button>

                <!-- JS-driven: clears all inputs to blank (not revert to value attr) -->
                <button type="button" id="clearBtn" class="btn btn-outline-secondary btn-lg">
                  <i class="bi bi-x-circle"></i> Clear All
                </button>
              </div>

            </form>

          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Spinner Overlay -->
  <div id="loadingOverlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Prediction Result Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content shadow-lg border-0 rounded-4">
        <div class="modal-header result-header rounded-top-4">
          <h5 class="modal-title" id="resultModalLabel">Prediction Results</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body p-4">

          {% if prediction %}
            {% if prediction < 1.0 %}{% set prediction = 1.0 %}{% elif prediction > 5.0 %}{% set prediction = 5.0 %}{% endif %}

            {% set equivalent = '' %}
            {% set badge_class = 'bg-secondary' %}
            {% if prediction >= 1.0 and prediction <= 1.25 %}
              {% set equivalent = 'Excellent' %}
              {% set badge_class = 'bg-success' %}
            {% elif prediction >= 1.26 and prediction <= 1.75 %}
              {% set equivalent = 'Very Satisfactory' %}
              {% set badge_class = 'bg-success' %}
            {% elif prediction >= 1.76 and prediction <= 2.25 %}
              {% set equivalent = 'Satisfactory' %}
              {% set badge_class = 'bg-primary' %}
            {% elif prediction >= 2.26 and prediction <= 3.0 %}
              {% set equivalent = 'Fairly Satisfactory' %}
              {% set badge_class = 'bg-warning text-dark' %}
            {% elif prediction >= 3.1 and prediction <= 4.0 %}
              {% set equivalent = 'Conditional Failure' %}
              {% set badge_class = 'bg-danger' %}
            {% elif prediction >= 4.1 %}
              {% set equivalent = 'Failed' %}
              {% set badge_class = 'bg-dark' %}
            {% endif %}

            
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
              <div>
                <div class="text-muted small">Predicted General Weighted Average (GWA)</div>
                <div class="display-5 fw-bold text-dark">{{ "%.2f"|format(prediction) }}</div>
              </div>
              <div class="text-end">
                <span class="badge {{ badge_class }} fs-6 rounded-pill px-3 py-2">{{ equivalent }}</span>
              </div>
            </div>

            <div class="mt-3">
              <div class="progress" style="height: 10px;">
                <div class="progress-bar" role="progressbar"
                     style="width: {{ ((5 - prediction) / 4 * 100) | round(0) }}%"
                     aria-valuenow="{{ prediction }}" aria-valuemin="1" aria-valuemax="5"></div>
              </div>
              <div class="d-flex justify-content-between small text-muted mt-1">
                <span>Best (1.0)</span><span>3.0</span><span>Worst (5.0)</span>
              </div>
            </div>

            {% set suggestion_pool = {
              'Excellent': [
                "Sustain your high level of academic discipline and consider pursuing advanced enrichment opportunities.",
                "Continue to challenge yourself with higher-level materials and independent research.",
                "Share your expertise by mentoring peers or contributing to academic organizations."
              ],
              'Very Satisfactory': [
                "Maintain consistency in your study habits while seeking opportunities to refine your skills.",
                "Engage in regular reviews to strengthen subject mastery and aim for higher academic distinction.",
                "Participate in collaborative learning to deepen understanding and enhance performance."
              ],
              'Satisfactory': [
                "Enhance time management strategies to allocate sufficient focus for academic tasks.",
                "Seek guidance from instructors when clarification is needed to avoid knowledge gaps.",
                "Apply structured practice through self-assessments to reinforce comprehension."
              ],
              'Fairly Satisfactory': [
                "Dedicate additional study time to subjects requiring greater attention.",
                "Develop and adhere to a structured weekly learning plan for consistent progress.",
                "Minimize distractions and create a conducive environment for effective study."
              ],
              'Conditional Failure': [
                "Seek proactive consultation with faculty or academic mentors to address learning challenges.",
                "Prioritize core competencies before advancing to more complex topics.",
                "Utilize peer support and collaborative learning to strengthen comprehension."
              ],
              'Failed': [
                "Reevaluate and adjust study approaches to establish more effective learning strategies.",
                "Seek academic assistance programs such as tutorials, mentoring, or study clinics.",
                "Develop a disciplined daily study routine focused on fundamental skills.",
                "Temporarily reduce non-academic engagements to prioritize academic recovery."
              ]
            } %}

            {# Color mapping based on equivalent #}
            {% set color_map = {
              'Excellent': 'success',
              'Very Satisfactory': 'primary',
              'Satisfactory': 'info',
              'Fairly Satisfactory': 'warning',
              'Conditional Failure': 'warning',
              'Failed': 'danger'
            } %}

            {% set pool = suggestion_pool.get(equivalent, []) | unique | list %}
            {% set suggestion = pool | random %}
            {% set color = color_map.get(equivalent, 'secondary') %}

            {# Random display style #}
            {% set styles = ['card', 'alert', 'list'] %}
            {% set style = styles | random %}

            <div class="mt-4">
              <h6 class="fw-bold">Professional Suggestion for Academic Improvement</h6>

              {% if suggestion %}
                {% if style == 'card' %}
                  <div class="card border-{{ color }} shadow-sm rounded-3">
                    <div class="card-body text-{{ color }}">
                      <p class="mb-0">{{ suggestion }}</p>
                    </div>
                  </div>
                {% elif style == 'alert' %}
                  <div class="alert alert-{{ color }} rounded-3 shadow-sm">
                    {{ suggestion }}
                  </div>
                {% elif style == 'list' %}
                  <ul class="list-group shadow-sm rounded-3">
                    <li class="list-group-item list-group-item-{{ color }}">
                      {{ suggestion }}
                    </li>
                  </ul>
                {% endif %}
              {% else %}
                <div class="text-muted fst-italic">No suggestion available at this time.</div>
              {% endif %}
            </div>


            <hr class="my-4">
            <div class="row g-3 text-center">
              {% if rq is not none %}
                <div class="col-12 col-sm-4">
                  <div class="metric-box">
                    <div class="small text-muted">R²</div>
                    <div class="h5 mb-0">{{ "%.3f"|format(rq) }}</div>
                    <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" 
                        style="width: {{ rq * 100 }}%;" 
                        aria-valuenow="{{ rq * 100 }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                  </div>
                </div>
              {% endif %}
              {% if rmse is not none %}
                <div class="col-12 col-sm-4">
                  <div class="metric-box">
                    <div class="small text-muted">RMSE</div>
                    <div class="h5 mb-0">{{ "%.3f"|format(rmse) }}</div>
                    <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" 
                        style="width: {{ (1 - (rmse / 10)) * 100 }}%;" 
                        aria-valuenow="{{ (1 - (rmse / 10)) * 100 }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                  </div>
                </div>
              {% endif %}
              {% if mae is not none %}
                <div class="col-12 col-sm-4">
                  <div class="metric-box">
                    <div class="small text-muted">MAE</div>
                    <div class="h5 mb-0">{{ "%.3f"|format(mae) }}</div>
                    <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" 
                        style="width: {{ (1 - (mae / 10)) * 100 }}%;" 
                        aria-valuenow="{{ (1 - (mae / 10)) * 100 }}" aria-valuemin="0" aria-valuemax="100">
                    </div>
                  </div>
                  </div>
                </div>
              {% endif %}
            </div>
            <div class="row mt-4">
            <div class="col-12">
              <div class="alert alert-info text-start small" role="alert">
                <h6 class="fw-bold">Understanding the Metrics:</h6>
                <p><strong>R² (R-Squared):</strong> This tells us how well the prediction matches the actual student grades. A value closer to 1 means the prediction is very accurate.</p>
                <p><strong>RMSE (Root Mean Square Error):</strong> This shows the average size of the prediction mistakes. Lower values mean the predictions are closer to the real grades.</p>
                <p><strong>MAE (Mean Absolute Error):</strong> This also shows the average error in predictions, but in a simpler way. Like RMSE, smaller numbers mean better accuracy.</p>
              </div>
            </div>
          </div>

          {% else %}
            <p class="text-muted mb-0">No prediction yet. Fill out the form and submit to see results.</p>
          {% endif %}

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    (function () {
      'use strict';
      const form = document.getElementById('gwaForm');
      const overlay = document.getElementById('loadingOverlay');

      // Show spinner on submit (server-side POST will reload the page)
      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        } else {
          overlay.style.display = 'flex';
        }
        form.classList.add('was-validated');
      }, false);

      // Clear All button: clears all inputs/selects/textarea to empty
      document.getElementById('clearBtn').addEventListener('click', function () {
        const elements = form.querySelectorAll('input, select, textarea');
        elements.forEach(el => {
          if (el.tagName === 'SELECT') {
            el.selectedIndex = 0;
          } else if (el.type === 'checkbox' || el.type === 'radio') {
            el.checked = false;
          } else {
            el.value = '';
          }
        });
        form.classList.remove('was-validated');

        // hide result modal if visible
        const modalEl = document.getElementById('resultModal');
        const instance = bootstrap.Modal.getInstance(modalEl);
        if (instance) instance.hide();
      });

      // Auto-open modal when a prediction exists (after server response)
      const hasPrediction = {{ 'true' if (prediction is defined and prediction is not none) else 'false' }};
      if (hasPrediction) {
        const modalEl = document.getElementById('resultModal');
        const resultModal = new bootstrap.Modal(modalEl, {keyboard: true});
        resultModal.show();
      }
    })();
  </script>
</body>
</html>
